---
title: "Sample Size Given Desired Power (Internal)"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    options:
      toc:
        depth: 2
      number_sections: true
vignette: >
  %\VignetteIndexEntry{Sample Size Given Desired Power (Internal)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
csl: apa.csl
---

```{r setup_doc, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = ""
)
```

# NOTE

This article is for internal testing
of the printout.

```{r load_packages}
library(power4mome)
```

```{r model}
mod <-
"
m ~ x
y ~ m + x
"
```


```{r pop_es}
mod_es <-
"
m ~ x: l
y ~ m: m
y ~ x: s
"
```

```{r sim_out, results=FALSE}
out <- power4test(nrep = 2,
                  model = mod,
                  pop_es = mod_es,
                  n = 50000,
                  iseed = 1234)
```

```{r sim_out_print}
print(out,
      data_long = TRUE)
```

```{r test_out, results=FALSE}
out <- power4test(nrep = 10,
                  model = mod,
                  pop_es = mod_es,
                  n = 50,
                  R = 199,
                  ci_type = "mc",
                  test_fun = test_indirect_effect,
                  test_args = list(x = "x",
                                   m = "m",
                                   y = "y",
                                   mc_ci = TRUE),
                  iseed = 2345,
                  parallel = TRUE)
```

```{r test_out_print}
print(out,
      test_long = TRUE)
```

```{r x_out, results=FALSE, message=FALSE}
out_n <- n_from_power(out,
                      target_power = .80,
                      final_nrep = 50,
                      what = "ub",
                      seed = 4567)
```

```{r x_out_print}
out_n
```

```{r x_out_summary}
summary(out_n)
```

```{r x_from_power_for_n_plot_test, fig.cap="The Power Curve", fig.align="center"}
plot(out_n)
```

```{r x_out_lb, results=FALSE, message=FALSE}
out_n_lb <- n_from_power(out,
                         target_power = .80,
                         final_nrep = 50,
                         what = "lb",
                         seed = 2345)
```

```{r x_out_lb_print}
out_n_lb
```

```{r x_out_lb_summary}
summary(out_n_lb)
```

```{r x_from_power_for_n_lb_plot_test, fig.cap="The Power Curve", fig.align="center"}
plot(out_n_lb)
```

```{r region}
n_power_region <- n_region_from_power(out,
                                      seed = 1357)
n_power_region
```

```{r region_plot, fig.cap="The Power Curve (Region)", fig.align="center"}
plot(n_power_region)
```

