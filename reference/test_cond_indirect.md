# Test a Conditional Indirect Effect

Test a conditional indirect effect for a `power4test` object.

## Usage

``` r
test_cond_indirect(
  fit = fit,
  x = NULL,
  m = NULL,
  y = NULL,
  wvalues = NULL,
  mc_ci = TRUE,
  mc_out = NULL,
  boot_ci = FALSE,
  boot_out = NULL,
  check_post_check = TRUE,
  test_method = c("ci", "pvalue"),
  ...,
  fit_name = "fit",
  get_map_names = FALSE,
  get_test_name = FALSE
)
```

## Arguments

- fit:

  The fit object, to be passed to
  [`manymome::cond_indirect()`](https://sfcheung.github.io/manymome/reference/cond_indirect.html).

- x:

  The name of the `x`-variable, the predictor.

- m:

  A character vector of the name(s) of mediator(s). The path moves from
  the first mediator in the vector to the last mediator in the vector.
  Can be `NULL` and the path is a direct path without mediator.

- y:

  The name of the `y`-variable, the outcome variable.

- wvalues:

  A numeric vector of named elements. The names are the variable names
  of the moderators, and the values are the values to which the
  moderators will be set to. Default is `NULL`.

- mc_ci:

  Logical. If `TRUE`, the default, Monte Carlo confidence intervals will
  be formed. This argument and `boot_ci` cannot be both `TRUE`.

- mc_out:

  The pre-generated Monte Carlo estimates generated by
  [manymome::do_mc](https://sfcheung.github.io/manymome/reference/do_mc.html),
  stored in a `power4test` object. Users should not set this argument
  and should let
  [`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)
  to set it automatically.

- boot_ci:

  Logical. If `TRUE`, the default, nonparametric bootstrap confidence
  intervals will be formed. This argument and `mc_ci` cannot be both
  `TRUE`.

- boot_out:

  The pre-generated bootstrap estimates generated by
  [manymome::do_boot](https://sfcheung.github.io/manymome/reference/do_boot.html),
  stored in a `power4test` object. Users should not set this argument
  and should let
  [`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)
  to set it automatically.

- check_post_check:

  Logical. If `TRUE`, the default, and the model is fitted by `lavaan`,
  the test will be conducted only if the model passes the `post.check`
  conducted by
  [`lavaan::lavInspect()`](https://rdrr.io/pkg/lavaan/man/lavInspect.html)
  (with `what = "post.check"`).

- test_method:

  The method to do the test. If `"ci"`, then the confidence interval
  (e.g., bootstrap confidence interval) will be used to do the test. If
  `"pvalue"`, then asymmetric *p*-value by Asparouhov & Muthén (2021)
  will be used to do the test, and the confidence interval will not be
  computed.

- ...:

  Additional arguments to be passed to
  [`manymome::cond_indirect()`](https://sfcheung.github.io/manymome/reference/cond_indirect.html).

- fit_name:

  The name of the model fit object to be extracted. Default is `"fit"`.
  Used only when more than one model is fitted in each replication. This
  should be the name of the model on which the test is to be conducted.

- get_map_names:

  Logical. Used by
  [`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)
  to determine how to extract stored information and assign them to this
  function. Users should not use this argument.

- get_test_name:

  Logical. Used by
  [`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)
  to get the default name of this test. Users should not use this
  argument.

## Value

In its normal usage, it returns a named numeric vector with the
following elements:

- `est`: The mean of the estimated indirect effect across datasets.

- `cilo` and `cihi`: The means of the lower and upper limits of the
  confidence interval (95% by default), respectively.

- `sig`: Whether a test by confidence interval is significant (`1`) or
  not significant (`0`).

## Details

This function is to be used in
[`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)
for testing a conditional indirect effect, by setting it to the
`test_fun` argument.

It uses
[`manymome::cond_indirect()`](https://sfcheung.github.io/manymome/reference/cond_indirect.html)
to do the test. It can be used on models fitted by
[`lavaan::sem()`](https://rdrr.io/pkg/lavaan/man/sem.html) or fitted by
a sequence of calls to [`stats::lm()`](https://rdrr.io/r/stats/lm.html),
although only nonparametric bootstrap confidence interval is supported
for models fitted by regression using
[`stats::lm()`](https://rdrr.io/r/stats/lm.html).

It can also be used to test a conditional effect on a direct path with
no mediator. Just omit `m` when calling the function.

## See also

[`power4test()`](https://sfcheung.github.io/power4mome/reference/power4test.md)

## Examples

``` r
# Specify the model

model_simple_mod <-
"
m ~ x + w + x:w
y ~ m + x
"

# Specify the population values

model_simple_mod_es <-
"
y ~ m: l
y ~ x: n
m ~ x: m
m ~ w: n
m ~ x:w: l
"

# Simulate the data

sim_only <- power4test(nrep = 5,
                       model = model_simple_mod,
                       pop_es = model_simple_mod_es,
                       n = 100,
                       R = 100,
                       do_the_test = FALSE,
                       iseed = 1234)
#> Simulate the data:
#> Fit the model(s):
#> Generate Monte Carlo estimates:

# Do the test in each replication

test_ind <- power4test(object = sim_only,
                       test_fun = test_cond_indirect,
                       test_args = list(x = "x",
                                        m = "m",
                                        y = "y",
                                        wvalues = c(w = 1),
                                        mc_ci = TRUE))
#> Do the test: test_cond_indirect: x->m->y (w = 1) 
print(test_ind,
      test_long = TRUE)
#> 
#> ====================== Model Information ======================
#> 
#> == Model on Factors/Variables ==
#> 
#> m ~ x + w + x:w
#> y ~ m + x
#> 
#> == Model on Variables/Indicators ==
#> 
#> m ~ x + w + x:w
#> y ~ m + x
#> 
#> ====== Population Values ======
#> 
#> Regressions:
#>                    Population
#>   m ~                        
#>     x                 0.300  
#>     w                 0.000  
#>     x:w               0.150  
#>   y ~                        
#>     m                 0.500  
#>     x                 0.000  
#> 
#> Covariances:
#>                    Population
#>   x ~~                       
#>     w                 0.000  
#>     x:w               0.000  
#>   w ~~                       
#>     x:w               0.000  
#> 
#> Variances:
#>                    Population
#>    .m                 0.888  
#>    .y                 0.750  
#>     x                 1.000  
#>     w                 1.000  
#>     x:w               1.000  
#> 
#> (Computing indirect effects for 1 paths ...)
#> 
#> (Computing conditional effects for 2 paths ...)
#> 
#> == Population Conditional/Indirect Effect(s) ==
#> 
#> == Effect(s) ==
#> 
#>        ind
#> x -> y   0
#> 
#>  - The 'ind' column shows the effect(s).
#>  
#> == Conditional indirect effects ==
#> 
#>  Path: x -> m -> y
#>  Conditional on moderator(s): w
#>  Moderator(s) represented by: w
#> 
#>       [w] (w)   ind   m~x   y~m
#> 1 M+1.0SD   1 0.225 0.450 0.500
#> 2 Mean      0 0.150 0.300 0.500
#> 3 M-1.0SD  -1 0.075 0.150 0.500
#> 
#>  - The 'ind' column shows the conditional indirect effects.
#>  - ‘m~x’,‘y~m’ is/are the path coefficient(s) along the path conditional
#>    on the moderator(s).
#> 
#> 
#> == Conditional indirect effects ==
#> 
#>  Path: w -> m -> y
#>  Conditional on moderator(s): x
#>  Moderator(s) represented by: x
#> 
#>       [x] (x)    ind    m~w   y~m
#> 1 M+1.0SD   1  0.075  0.150 0.500
#> 2 Mean      0 -0.000 -0.000 0.500
#> 3 M-1.0SD  -1 -0.075 -0.150 0.500
#> 
#>  - The 'ind' column shows the conditional indirect effects.
#>  - ‘m~w’,‘y~m’ is/are the path coefficient(s) along the path conditional
#>    on the moderator(s).
#> 
#> 
#> ======================= Data Information =======================
#> 
#> Number of Replications:  5 
#> Sample Sizes:  100 
#> 
#> Call print with 'data_long = TRUE' for further information.
#> 
#> ==================== Extra Element(s) Found ====================
#> 
#> - fit
#> - mc_out
#> 
#> === Element(s) of the First Dataset ===
#> 
#> ============ <fit> ============
#> 
#> lavaan 0.6-20 ended normally after 1 iteration
#> 
#>   Estimator                                         ML
#>   Optimization method                           NLMINB
#>   Number of model parameters                         7
#> 
#>   Number of observations                           100
#> 
#> Model Test User Model:
#>                                                       
#>   Test statistic                                 4.530
#>   Degrees of freedom                                 2
#>   P-value (Chi-square)                           0.104
#> 
#> =========== <mc_out> ===========
#> 
#> 
#> == A 'mc_out' class object ==
#> 
#> Number of Monte Carlo replications: 100 
#> 
#> 
#> ======== <test_cond_indirect: x->m->y (w = 1)> ========
#> 
#> Mean(s) across replication:
#>    est  cilo  cihi   sig
#>  0.206 0.068 0.377 0.800
#> 
#> - The value 'sig' is the rejection rate.
#> - If the null hypothesis is false, this is the power.
#> - Number of valid replications for rejection rate: 5 
#> - Proportion of valid replications for rejection rate: 1.000 
```
